<!DOCTYPE html>
<html>
<head>
<title>Stream上传插件 - Bootstrap Demo</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="/css/stream-v1.css" rel="stylesheet" type="text/css">
<link href="http://cdn.bootcss.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<!--[if lt IE 9]>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js"></script>
<![endif]-->
</head>
<body>

<div class="container">
	<div class="row clearfix">
		<div class="col-md-8 column">
			<div id="i_error_tips" class="alert alert-success alert-dismissable">
				<button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
				<strong> 提示： </strong> <span class="text-message"><span> 
			</div>
			
			<div class="page-header">
			  <h1>Stream上传插件 <small>bootstrap style demo</small></h1>
			</div>
			
			<p>本UI是模仿File Upload的Html5形式下的UI风格，满足不同客户在某些情况下需要自定义UI的需求.<br>
	        </p>
			
			<table id="data_table" class="table tablesorter">
				<thead>
					<tr><th>编号</th>
						<th>文件</th>
						<th>大小</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody id="bootstrap-stream-container">
				</tbody>
				<tfoot id="stream_total_progress_bar">
					<tr><th colspan="2">
							<div class="progress">
							  <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
							  </div>
							</div>
						</th>
						<th colspan="2"><span class="stream_total_size"></span>
							<span class="stream_total_percent"></span>
						</th>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>	
</div>

<div class="row">
  <div class="col-md-12">
     <br>
		<form id="fileupload" action="">
			<div class="row fileupload-buttonbar">
				<div class="col-lg-7">
					<!-- The fileinput-button span is used to style the file input field as button -->
					<span class="btn green fileinput-button" id="i_select_files">
						<i class="icon-plus"></i> <span>Add files...</span>
					</span>
					<button type="submit" class="btn blue start" onclick="javascript:_t.upload();">
						<i class="icon-upload"></i> <span>Start upload</span>
					</button>
					<button type="submit" class="btn yellow start" onclick="javascript:_t.stop();">
						<i class="icon-upload"></i> <span>Stop upload</span>
					</button>
					<button type="reset" class="btn red cancel" onclick="javascript:_t.cancel();">
						<i class="icon-ban-circle"></i> <span>Cancel upload</span>
					</button>
				</div>
			</div>
		</form>
		
	</div>
</div>

<script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/stream-v1.js"></script>
<script type="text/javascript">
/**
 * 配置文件（如果没有默认字样，说明默认值就是注释下的值）
 * 但是，on*（onSelect， onMaxSizeExceed...）等函数的默认行为
 * 是在ID为i_stream_message_container的页面元素中写日志
 */
 
	var config = {
		enabled: true, /** 是否启用文件选择，默认是true */
		customered: true,
		multipleFiles: true, /** 是否允许同时选择多个文件，默认是false */	
		autoRemoveCompleted: false, /** 是否自动移除已经上传完毕的文件，非自定义UI有效(customered:false)，默认是false */
		autoUploading: true, /** 当选择完文件是否自动上传，默认是true */
		fileFieldName: "FileData", /** 相当于指定<input type="file" name="FileData">，默认是FileData */
		maxSize: 2147483648, /** 当_t.bStreaming = false 时（也就是Flash上传时），2G就是最大的文件上传大小！所以一般需要 */
		simLimit: 10000, /** 允许同时选择文件上传的个数（包含已经上传过的） */
		extFilters: [".txt", ".gz", ".jpg", ".png", ".jpeg", ".gif", ".avi"], /** 默认是全部允许，即 [] */
		browseFileId : "i_select_files", /** 文件选择的Dom Id，如果不指定，默认是i_select_files */
		browseFileBtn : "<div>请选择文件</div>", /** 选择文件的按钮内容，非自定义UI有效(customered:false) */
		filesQueueId : "i_stream_files_queue", /** 文件上传进度显示框ID，非自定义UI有效(customered:false) */
		filesQueueHeight : 450, /** 文件上传进度显示框的高，非自定义UI有效(customered:false)，默认450px */
		messagerId : "i_stream_message_container", /** 消息框的Id，当没有自定义onXXX函数，系统会显示onXXX的部分提示信息，如果没有i_stream_message_container则不显示 */
		onSelect: function(files) {
			//console && console.log("-------------onSelect-------------------");
			//console && console.log(files);
			//console && console.log("-------------onSelect-------------------End");
		},
		onMaxSizeExceed: function(file) {
			//console && console.log("-------------onMaxSizeExceed-------------------");
			//console && console.log(file);
			$("#i_error_tips > span.text-message").append("文件[name="+file.name+", size="+file.formatSize+"]超过文件大小限制‵"+file.formatLimitSize+"‵，将不会被上传！<br>");
			//console && console.log("-------------onMaxSizeExceed-------------------End");
		},
		onFileCountExceed : function(selected, limit) {
			//console && console.log("-------------onFileCountExceed-------------------");
			//console && console.log(selected + "," + limit);
			$("#i_error_tips > span.text-message").append("同时最多上传<strong>"+limit+"</strong>个文件，但是已选择<strong>"+selected+"</strong>个<br>");
			//console && console.log("-------------onFileCountExceed-------------------End");
		},
		onExtNameMismatch: function(info) {
			//console && console.log("-------------onExtNameMismatch-------------------");
			//console && console.log(info);
			$("#i_error_tips > span.text-message").append("<strong>"+info.name+"</strong>文件类型不匹配[<strong>"+info.filters.toString() + "</strong>]<br>");
			//console && console.log("-------------onExtNameMismatch-------------------End");
		},
		onAddTask: function(f) {
			 var file = '<tr id="' + f.id + '" class="template-upload fade in">' +
		     '<td><span class="preview">'+f.id+'</span></td>' +
		     '<td><p class="name">' + f.name + '</p>' +
		     '    <div><span class="label label-info">进度：</span> <span class="message-text"></span></div>' +
		     '    <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">' +
			'			<div class="progress-bar progress-bar-success" title="" style="width: 0%;"></div>' +
			'		</div>' +
		     '</td>' +
		     '<td><p class="size">' + f.formatSize + '</p>' +
		     '</td>' +
		     '<td><button class="btn red cancel" onClick="javascript:_t.cancelOne(\'' + f.id + '\')">' +
		     '       <i class="icon-ban-circle"></i>' +
		     '       <span>Cancel</span>' +
		     '    </button>' +
		     '</td></tr>';
			
			$("#bootstrap-stream-container").append(file);
		},
		onUploadProgress: function(f) {
			//console && console.log("-------------onUploadProgress-------------------");
			//console && console.log(f);
			
			var $bar = $("#"+f.id).find("div.progress-bar");
			$bar.css("width", f.percent + "%");
			var $message = $("#"+f.id).find("span.message-text");
			$message.text("已上传:" + f.formatLoaded + "/" + f.formatSize + "(" + f.percent + "%" + ") 速  度:" + f.formatSpeed);
			
			var $total = $("#stream_total_progress_bar");
			$total.find("div.progress-bar").css("width", f.totalPercent + "%");
			$total.find("span.stream_total_size").html(f.formatTotalLoaded + "/" + f.formatTotalSize);
			$total.find("span.stream_total_percent").html(f.totalPercent + "%");
			
			//console && console.log("-------------onUploadProgress-------------------End");
		},
		onStop: function() {
			//console && console.log("-------------onStop-------------------");
			//console && console.log("系统已停止上传！！！");
			//console && console.log("-------------onStop-------------------End");
		},
		onCancel: function(f) {
			//console && console.log("-------------onCancel-------------------");
			//console && console.log(f);
			
			$("#"+f.id).remove();
			
			var $total = $("#stream_total_progress_bar");
			$total.find("div.progress-bar").css("width", f.totalPercent + "%");
			$total.find("span.stream_total_size").text(f.formatTotalLoaded + "/" + f.formatTotalSize);
			$total.find("span.stream_total_percent").text(f.totalPercent + "%");
			//console && console.log("-------------onCancel-------------------End");
		},
		onCancelAll: function(numbers) {
			//console && console.log("-------------onCancelAll-------------------");
			console && console.log(numbers + " 个文件已被取消上传！！！");
			
			//console && console.log("-------------onCancelAll-------------------End");
		},
		onComplete: function(f) {
			//console && console.log("-------------onComplete-------------------");
			//console && console.log(f);
			
			/** 100% percent */
			var $bar = $("#"+f.id).find("div.progress-bar");
			$bar.css("width", f.percent + "%");
			var $message = $("#"+f.id).find("span.message-text");
			$message.text("已上传:" + f.formatLoaded + "/" + f.formatSize + "(" + f.percent + "%" + ")");
			/** remove the `cancel` button */
			var $cancelBtn = $("#"+f.id).find("td > button");
			$cancelBtn.remove();
			
			/** modify the total progress bar */
			var $total = $("#stream_total_progress_bar");
			$total.find("div.progress-bar").css("width", f.totalPercent + "%");
			$total.find("span.stream_total_size").text(f.formatTotalLoaded + "/" + f.formatTotalSize);
			$total.find("span.stream_total_percent").text(f.totalPercent + "%");
			
			//console && console.log("-------------onComplete-------------------End");
		},
		onQueueComplete: function(msg) {
			//console && console.log("-------------onQueueComplete-------------------");
			//console && console.log(msg);
			//console && console.log("-------------onQueueComplete-------------------End");
		},
		onUploadError: function(status, msg) {
			//console && console.log("-------------onUploadError-------------------");
			//console && console.log(msg + ", 状态码:" + status);
			
			$("#i_error_tips > span.text-message").append(msg + ", 状态码:" + status);
			
			//console && console.log("-------------onUploadError-------------------End");
		}
	};
	var _t = new Stream(config);
</script>
</body>