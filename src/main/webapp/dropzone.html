<!DOCTYPE html>
<html>

	<head>
		<title>Stream上传插件 - Dropzone样式</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="css/dropzone.css" />

		<style>
			body{color: rgb(100, 108, 127);  line-height: 28px;}
				.dropzone {
			  border: 2px dashed #0087F7;
			  border-radius: 5px;
			  background: white;
			}
			.dropzone .dz-message {
			  font-weight: 400;
			}
			.dropzone .dz-message .note {
			  font-size: 0.8em;
			  font-weight: 200;
			  display: block;
			  margin-top: 1.4rem;
			}
		</style>
	</head>

	<body>

		<section>

			<h1 id="try-it-out">提供HTML5支持较好的<em>Dropzonejs</em>的样例</h1>

			<div id="dropzone">
				<form action="/upload" class="dropzone dz-clickable dz-started" id="demo-upload">
				</form>
			</div>

		</section>

		<script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
		<script type="text/javascript" src="/js/stream-v1.js"></script>
		<script id="DropUploadMessage" type="text/template">
			<div class="dz-message">
				将您的文件（或文件夹）拖拽到这里开始上传。
				<br>
				<span class="note">(Dropzone风格样例。文件上传至服务器之后将会被 <strong>删除</strong> 。)</span>
			</div>
		</script>

		<script id="UploadFileModule" type="text/template">
			<div id="#FILE_ID#" class="dz-preview dz-file-preview dz-processing dz-error">
				<div class="dz-image"><img data-dz-thumbnail=""></div>

				<div class="dz-details">
					<div class="dz-size"><span data-dz-size="">#FILE_SIZE#</span></div>
					<div class="dz-filename"><span data-dz-name="">#FILE_NAME#</span></div>
				</div>
				<div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress=""></span></div>
				<div class="dz-error-message"><span data-dz-errormessage="">点击✖️将取消本文件上传。</span></div>

				<div class="dz-success-mark">

					<svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
						<!-- Generator: Sketch 3.2.1 (9971) - http://www.bohemiancoding.com/sketch -->
						<title>Check</title>
						<desc>Created with Sketch.</desc>
						<defs></defs>
						<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
							<path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z"
							id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
						</g>
					</svg>

				</div>
				<div class="dz-error-mark">

					<svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
						<!-- Generator: Sketch 3.2.1 (9971) - http://www.bohemiancoding.com/sketch -->
						<title>error</title>
						<desc>Created with Sketch.</desc>
						<defs></defs>
						<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
							<g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">
								<path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z"
								id="Oval-2" sketch:type="MSShapeGroup"></path>
							</g>
						</g>
					</svg>

				</div>

			</div>

		</script>

		<script type="text/javascript">
			/**
			 * 配置文件（如果没有默认字样，说明默认值就是注释下的值）
			 * 但是，on*（onSelect， onMaxSizeExceed...）等函数的默认行为
			 * 是在ID为i_stream_message_container的页面元素中写日志
			 */
			 
				var config = {
					enabled: true, /** 是否启用文件选择，默认是true */
					customered: true,
					multipleFiles: true, /** 是否允许同时选择多个文件，默认是false */	
					autoUploading: true, /** 当选择完文件是否自动上传，默认是true */
					fileFieldName: "FileData", /** 相当于指定<input type="file" name="FileData">，默认是FileData */
					maxSize: 2147483648, /** 当_t.bStreaming = false 时（也就是Flash上传时），2G就是最大的文件上传大小！所以一般需要 */
					simLimit: 10000, /** 允许同时选择文件上传的个数（包含已经上传过的） */
			//		extFilters: [".txt", ".gz", ".jpg", ".png", ".jpeg", ".gif", ".avi", ".html", ".htm"], /** 默认是全部允许，即 [] */
					browseFileId : "demo-upload", /** 文件选择的Dom Id，如果不指定，默认是i_select_files */
					dragAndDropTips : $('#DropUploadMessage').text().trim(),
					dragAndDropArea: "demo-upload",
			//		frmUploadURL : "http://customers.duapp.com/fd;", /** Flash上传的URI */
			//      uploadURL : "http://customers.duapp.com/upload",
					onSelect: function(files) {
						for(var i=0; i<files.length; i++) {
							var tmpl = $("#UploadFileModule").text().trim();
							var instance = tmpl.replace(/#FILE_ID#/g, files[i].id)
							.replace(/#FILE_NAME#/g, files[i].name)
							.replace(/#FILE_SIZE#/g, _t.formatBytes(files[i].size));

							$("#demo-upload").append(instance);
							
							$("#"+ files[i].id).click(function(e) {
								e.stopPropagation();
								if ($(this).hasClass('dz-processing')) {
									$(this).remove();
								}
							});
						}
					},
					onMaxSizeExceed: function(file) {
						var $module = $("#"+ file.id);
						$module.addClass("dz-error dz-complete");
						//console && console.log("-------------onMaxSizeExceed-------------------");
						//console && console.log(file);
						$module.find(".dz-error-message span").text("文件[name="+file.name+", size="+file.formatSize+"]超过文件大小限制‵"+file.formatLimitSize+"‵，将不会被上传！");
						//console && console.log("-------------onMaxSizeExceed-------------------End");
					},
					onFileCountExceed : function(selected, limit) {
						var $module = $("#"+ file.id);
						$module.addClass("dz-error dz-complete");
						$module.find(".dz-error-message span").text("同时最多上传<strong>"+limit+"</strong>个文件，但是已选择<strong>"+selected+"</strong>个");
					},
					onExtNameMismatch: function(info) {
						var $module = $("#"+ file.id);
						$module.addClass("dz-error dz-complete");
						$module.find(".dz-error-message span").text("<strong>"+info.name+"</strong>文件类型不匹配[<strong>"+info.filters.toString() + "</strong>]");
					},
					onAddTask: function(file, dat) {
						// 图片回显
						if (dat && dat.file && dat.file.type && dat.file.type.indexOf('image') == 0) {
							var $module = $("#"+ file.id);
							$module.addClass('dz-image-preview');
							$module.removeClass('dz-file-preview');
							
							var reader = new FileReader();
			          reader.readAsDataURL(dat.file);
			          reader.onload = function(evt) {
			          		var img = $('#' + file.id).find('.dz-image img');
			          		img.attr('src', reader.result);
			          		img.attr('alt', file.name);
			          		img.attr('width', '120px');
			          }
						}
						
					},
					onUploadProgress: function(file) {
						var $bar = $("#"+file.id).find("div.dz-progress span.dz-upload");
						$bar.css("width", file.percent + "%");
					},
					onStop: function() {
					},
					onCancel: function(file) {
						$("#" + file.id).remove();
					},
					onCancelAll: function(numbers) {
					},
					onComplete: function(file) {
						/** 100% percent */
						var $bar = $("#"+file.id).find("div.progress-bar");
						$bar.css("width", file.percent + "%");
						
						var module = $("#"+file.id);
						module.addClass("dz-complete dz-success");
						module.removeClass('dz-processing dz-error');
					},
					onQueueComplete: function(msg) {
						//console && console.log("-------------onQueueComplete-------------------");
						//console && console.log(msg);
						//console && console.log("-------------onQueueComplete-------------------End");
					},
					onUploadError: function(status, msg) {
						//console && console.log("-------------onUploadError-------------------");
						//console && console.log(msg + ", 状态码:" + status);
						
						$("#i_error_tips > span.text-message").append(msg + ", 状态码:" + status);
						
						//console && console.log("-------------onUploadError-------------------End");
					}
				};
				var _t = new Stream(config);
				/** 不支持拖拽，隐藏拖拽框 */
				if (!_t.bDraggable) {
					$("#i_stream_dropzone").hide();
				}
				/** Flash最大支持2G */
				if (!_t.bStreaming) {
					_t.config.maxSize = 2147483648;
				}
				
				if (!_t.bDraggable) {
					alert('你的浏览器不支持Dropzone样式的演示特性，换个现代浏览器试试！')
				}
		</script>
	</body>